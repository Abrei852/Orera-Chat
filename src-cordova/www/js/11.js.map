{"version":3,"sources":["webpack:///../src/pages/Room.vue?5def","webpack:///../src/boot/server.js","webpack:///../src/pages/Room.vue","webpack:///../src/pages/Room.vue?4142","webpack:///../src/pages/Room.vue?9f12","webpack:///../src/pages/Room.vue?5f6b","webpack:///../src/pages/Room.vue?7f8a"],"names":["servers","process"],"mappings":"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","file":"js/11.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('q-page',{staticClass:\"full-width\"},[(_vm.error)?_c('q-banner',{staticClass:\"bg-red-1 text-center text-red text-bold fixed-top\"},[_vm._v(_vm._s(_vm.error))]):_vm._e(),_c('video',{ref:\"localVideo\",staticClass:\"localUser\",attrs:{\"autoplay\":\"\",\"playsinline\":\"\"}}),_c('div',{staticClass:\"button row justify-center\"},[(!_vm.hangupButton)?_c('q-btn',{attrs:{\"round\":\"\",\"color\":\"secondary\",\"icon\":\"videocam\"},on:{\"click\":_vm.makeCall}}):_vm._e(),(_vm.hangupButton)?_c('q-btn',{attrs:{\"round\":\"\",\"color\":\"primary\",\"icon\":\"videocam_off\"},on:{\"click\":_vm.turnOffRemoteVideo}}):_vm._e()],1),_c('div',{attrs:{\"color\":\"transparent\"},on:{\"click\":_vm.confirm}}),_c('video',{ref:\"remoteVideo\",staticClass:\"remoteUser\",attrs:{\"autoplay\":\"\",\"playsinline\":\"\"}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","// Create an account on Viagenie, and replace credential and username with the information from your account\nvar servers = {\n  'iceServers': [\n    { 'urls': 'stun:stun.services.mozilla.com' },\n    // { 'urls': \"stun:stun01.sipphone.com\" },\n    // { 'urls': \"stun:stun.ekiga.net\" },\n    // { 'urls': \"stun:stun.fwdnet.net\" },\n    // { 'urls': \"stun:stun.ideasip.com\" },\n    // { 'urls': \"stun:stun.iptel.org\" },\n    // { 'urls': \"stun:stun.rixtelecom.se\" },\n    // { 'urls': \"stun:stun.schlund.de\" },\n    // { 'urls': \"stun:stun.l.google.com:19302\" },\n    // { 'urls': \"stun:stun1.l.google.com:19302\" },\n    // { 'urls': \"stun:stun2.l.google.com:19302\" },\n    // { 'urls': \"stun:stun3.l.google.com:19302\" },\n    // { 'urls': \"stun:stun4.l.google.com:19302\" },\n    // { 'urls': \"stun:stunserver.org\" },\n    // { 'urls': \"stun:stun.softjoys.com\" },\n    // { 'urls': \"stun:stun.voiparound.com\" },\n    // { 'urls': \"stun:stun.voipbuster.com\" },\n    // { 'urls': \"stun:stun.voipstunt.com\" },\n    // { 'urls': \"stun:stun.voxgratia.org\" },\n    // { 'urls': \"stun:stun.xten.com\" },\n    {\n      'urls': 'turn:numb.viagenie.ca',\n      'credential': `${process.env.CREDENTIAL}`,\n      'username': `${process.env.USERNAME}`,\n    },\n    {\n      'urls': \"turn:192.158.29.39:3478?transport=udp\",\n      'credential': \"JZEOEt2V3Qb0y27GRntt2u2PAYA=\",\n      'username': \"28224511:1379330808\"\n    },\n    // {\n    //   'urls': \"turn:192.158.29.39:3478?transport=tcp\",\n    //   'credential': \"JZEOEt2V3Qb0y27GRntt2u2PAYA=\",\n    //   'username': \"28224511:1379330808\"\n    // }\n  ]\n};\n\nexport { servers }\n","<template>\n  <q-page class=\"full-width\">\n    <q-banner\n      v-if=\"error\"\n      class=\"bg-red-1 text-center text-red text-bold fixed-top\"\n      >{{ error }}</q-banner\n    >\n    <video class=\"localUser\" ref=\"localVideo\" autoplay playsinline />\n    <div class=\"button row justify-center\">\n      <q-btn\n        v-if=\"!hangupButton\"\n        round\n        color=\"secondary\"\n        icon=\"videocam\"\n        @click=\"makeCall\"\n      />\n      <q-btn\n        v-if=\"hangupButton\"\n        round\n        color=\"primary\"\n        icon=\"videocam_off\"\n        @click=\"turnOffRemoteVideo\"\n      />\n    </div>\n    <div color=\"transparent\" @click=\"confirm\" />\n    <video class=\"remoteUser\" ref=\"remoteVideo\" autoplay playsinline />\n  </q-page>\n</template>\n\n<script>\nimport adapter from \"webrtc-adapter\";\n\nimport { firebaseDb } from \"boot/firebase\";\nimport { servers } from \"boot/server\";\n\nlet peerConnection = new RTCPeerConnection(servers);\nlet roomId = Math.floor(Math.random() * 1000000000);\n\nexport default {\n  data() {\n    return {\n      error: \"\",\n      hangupButton: false\n    };\n  },\n  methods: {\n    sendMessage(senderId, data) {\n      let msg = firebaseDb\n        .ref(\"videos\")\n        .push({ sender: senderId, message: data });\n      msg.remove();\n    },\n\n    readMessage(data) {\n      let msg = JSON.parse(data.val().message);\n      let sender = data.val().sender;\n      if (sender != roomId) {\n\n        if (msg.ice != undefined) {\n          peerConnection.addIceCandidate(new RTCIceCandidate(msg.ice));\n        } else if (msg.sdp.type == \"offer\") {\n          peerConnection\n            .setRemoteDescription(new RTCSessionDescription(msg.sdp))\n            .then(() => peerConnection.createAnswer())\n            .then(answer => peerConnection.setLocalDescription(answer))\n            .then(() =>\n              this.sendMessage(\n                roomId,\n                JSON.stringify({ sdp: peerConnection.localDescription })\n              )\n            )\n            .catch(\n              error => (this.error = \"A connection could not be established!\")\n            );\n        } else if (msg.sdp.type == \"answer\") {\n         \n          peerConnection.setRemoteDescription(\n            new RTCSessionDescription(msg.sdp)\n          );\n        }\n      }\n    },\n    startCamera() {\n      const constraints = {\n        video: {\n          width: { ideal: 4096 },\n          height: { ideal: 2160 },\n          facingMode: \"user\"\n        },\n        audio: {\n          sampleSize: 16,\n          volume: 0.2,\n          channelCount: {\n            ideal: 2\n          },\n          autoGainControl: false,\n          echoCancellation: true,\n          noiseSuppression: true\n        }\n      };\n      navigator.mediaDevices\n        .getUserMedia(constraints)\n        .then(stream => (this.$refs.localVideo.srcObject = stream))\n        .then(stream => peerConnection.addStream(stream))\n        .catch(\n          error =>\n            (this.error = \"Something went wrong, please refresh the page!\")\n        );\n    },\n    makeCall() {\n      peerConnection\n        .createOffer()\n        .then(offer => peerConnection.setLocalDescription(offer))\n        .then(() =>\n          this.sendMessage(\n            roomId,\n            JSON.stringify({ sdp: peerConnection.localDescription })\n          )\n        )\n        .catch(error => {\n          return (this.error =\n            \"Something went wrong, please refresh and call again!\");\n        });\n      this.hangupButton = true;\n    },\n\n    turnOffRemoteVideo() {\n      try {\n        const stream = this.$refs.remoteVideo.srcObject;\n        stream.getVideoTracks().forEach(track => {\n          track.stop();\n        });\n        peerConnection.close();\n        this.hangupButton = false;\n      } catch (error) {\n        return (this.error =\n          \"Something went wrong, please refresh and call again!\");\n      }\n    },\n\n    disableCamera() {\n      const stream = this.$refs.localVideo.srcObject;\n      stream.getVideoTracks().forEach(track => {\n        track.stop();\n      });\n      stream.getAudioTracks().forEach(track => {\n        track.stop();\n      });\n    },\n    confirm() {\n      this.$q\n        .dialog({\n          title: \"Confirm\",\n          message: \"Would you like to receive the call?\",\n          cancel: true,\n          persistent: true\n        })\n        .onCancel(() => {\n          this.turnOffRemoteVideo();\n        });\n    }\n  },\n  beforeMount() {\n    firebaseDb.ref(\"videos\").on(\"child_added\", this.readMessage);\n  },\n  mounted() {\n    this.startCamera();\n    peerConnection.onicecandidate = event =>\n      event.candidate\n        ? this.sendMessage(roomId, JSON.stringify({ ice: event.candidate }))\n        : console.log(\"Success\"); // Seperat funktion och error på banner\n\n    peerConnection.ontrack = ({ track, streams }) => {\n      // once media for a remote track arrives, show it in the remote video element\n      track.onunmute = () => {\n        // don't set srcObject again if it is already set.\n        if (this.$refs.remoteVideo.srcObject) return;\n        this.confirm();\n        this.$refs.remoteVideo.srcObject = streams[0];\n        this.hangupButton = true;\n      };\n    };\n  },\n  beforeDestroy() {\n    this.disableCamera();\n    this.turnOffRemoteVideo();\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n.q-banner {\n  width: 100%;\n  margin: 0 auto;\n  top: 50px;\n  z-index: 2;\n  opacity: 0.8;\n}\n.localUser {\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 50%;\n  position: absolute;\n  object-fit: cover;\n  @media (max-width: $breakpoint-sm-max) {\n    top: 0;\n    height: 50vh;\n    width: 100%;\n  }\n  @media (max-width: $breakpoint-xs-max) {\n    width: 100%;\n    height: 100%;\n  }\n}\n.q-btn {\n  margin-top: 80vh;\n  z-index: 2;\n}\n.remoteUser {\n  bottom: 0;\n  right: 0;\n  height: 100%;\n  width: 50%;\n  position: absolute;\n  object-fit: cover;\n  z-index: 1;\n  background: $dark;\n  @media (max-width: $breakpoint-sm-max) {\n    bottom: 0;\n    height: 50vh;\n    width: 100%;\n  }\n  @media (max-width: $breakpoint-xs-max) {\n    top: 0;\n    margin: 0.9rem;\n    height: 40vh;\n    width: 50vw;\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/@quasar/app/lib/webpack/loader.transform-quasar-imports.js!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@quasar/app/lib/webpack/loader.auto-import-client.js?kebab!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Room.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/@quasar/app/lib/webpack/loader.transform-quasar-imports.js!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@quasar/app/lib/webpack/loader.auto-import-client.js?kebab!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Room.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Room.vue?vue&type=template&id=70354161&scoped=true&\"\nimport script from \"./Room.vue?vue&type=script&lang=js&\"\nexport * from \"./Room.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Room.vue?vue&type=style&index=0&id=70354161&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"70354161\",\n  null\n  \n)\n\nexport default component.exports\nimport QPage from 'quasar/src/components/page/QPage.js';\nimport QBanner from 'quasar/src/components/banner/QBanner.js';\nimport QBtn from 'quasar/src/components/btn/QBtn.js';\nimport qInstall from \"../../node_modules/@quasar/app/lib/webpack/runtime.auto-import.js\";\nqInstall(component, 'components', {QPage,QBanner,QBtn});\n","// extracted by mini-css-extract-plugin","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-2-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-2-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-2-3!../../node_modules/@quasar/app/lib/webpack/loader.quasar-scss-variables.js!../../node_modules/@quasar/app/lib/webpack/loader.auto-import-client.js?kebab!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Room.vue?vue&type=style&index=0&id=70354161&lang=scss&scoped=true&\""],"sourceRoot":""}